<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ruuvi.firmware.c: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ruuvi.firmware.c
   </div>
   <div id="projectbrief">Ruuvi Firmware for nRF52 sensors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ruuvi.firmware.c Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://jenkins.ruuvi.com/job/ruuvi.firmware.c%20-%20deploy/">![Build Status](https://jenkins.ruuvi.com/buildStatus/icon?job=ruuvi.firmware.c+-+deploy)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=alert_status)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Bugs](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=bugs)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=code_smells)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Coverage](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=coverage)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Duplicated Lines (%)](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=duplicated_lines_density)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=ncloc)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=sqale_rating)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=reliability_rating)</a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=sqale_index)</a></p>
<p>Ruuvi Firmware version 3. Built on top of Nordic SDK 15, uses both Ruuvi and external repositories as submodules. Under development, please follow <a href="https://blog.ruuvi.com">Ruuvi Blog</a> for details. The project is in alpha stage, build maybe broken in obvious ways and not build at all or in non-obvious ways and fail on some Ruuvi boards.</p>
<h1>Setting up</h1>
<h2>SDK 15.3</h2>
<p>Download <a href="https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v15.x.x/">Nordic SDK15.3</a> and install it at the project root. If you're working on multiple nRF projects, you can (and should) use softlinking instead.</p>
<h2>Submodules</h2>
<p>Run <code>git submodule update --init --recursive</code>. This will search for and install the other git repositories referenced by this project. If any of the submodules has a changed remote, you'll need to run <code>git submodule sync --recursive</code> and again <code>git submodule update --init --recursive</code> to update the modules from new remotes.</p>
<h2>Toolchain</h2>
<p>ARMGCC is used for <a href="http://jenkins.ruuvi.com/job/ruuvi.firmware.c/">Jenkins builds</a>, it's recommended to use SES for developing. You can make the project and all variants by runnning "make" at top level of this repository.</p>
<p>Segger Embedded Studio can be set up by installing <a href="https://www.nordicsemi.com/?sc_itemid=%7BB935528E-8BFA-42D9-8BB5-83E2A5E1FF5C%7D">nRF Connect for Desktop</a> and following Getting Started plugin instructions.</p>
<p>Start SES and open <code>ruuvi_ruuvi.firmware.c.emProject</code> at root level, each of the target boards is in their own project.</p>
<h2>Code style</h2>
<p>Code is formatted with <a href="http://astyle.sourceforge.net">Artistic Style</a>. Run <code>astyle --project=.astylerc ./target_file</code>. To format the entire project, ``` astyle &ndash;project=.astylerc "src/main.c" astyle &ndash;project=.astylerc &ndash;recursive "src/application_config/*.h" astyle &ndash;project=.astylerc &ndash;recursive "src/tasks/*.c" astyle &ndash;project=.astylerc &ndash;recursive "src/tasks/*.h" astyle &ndash;project=.astylerc &ndash;recursive "src/tests/*.c" astyle &ndash;project=.astylerc &ndash;recursive "src/tests/*.h" ```</p>
<h2>Static analysis</h2>
<p>The code can be checked with PVS Studio and Sonarcloud for some common errors, style issues and potential problems. <a href="https://ruuvi.github.io/ruuvi.firmware.c/fullhtml/index.html">Here</a> is a link to generated report which gets pushed to GitHub.</p>
<h3>PVS</h3>
<p>Obtain license and software from <a href="https://www.viva64.com/en/pvs-studio/">Viva64</a>.</p>
<p>Make runs PVS Studio scan and outputs results under doxygen/html/fullhtml.</p>
<p>This results into hundreds of warnings, it is up to you to filter the data you're interested in. For example you probably want to filter out warnings related to 64-bit systems.</p>
<h3>Sonar scan</h3>
<p>Travis pushes the results to <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">SonarCloud.IO</a>. SonarCloud uses access token which is private to Ruuvi, you'll need to fork the project and setup the SonarCloud under your own account if you wish to run Sonar Scan on your own code.</p>
<h1>Running unit tests</h1>
<h2>Ceedling</h2>
<p>Unit tests are implemented with Ceedling. Run the tests with <code>ceedling test:all</code></p>
<h3>Gcov</h3>
<p>Ceedling can also generate Gcov reports with <code>ceedling gcov:all utils:gcov</code>. The report can be found under <em>build/artifacts/gcov</em>.</p>
<h2>Unit test continuous integration</h2>
<p>Travis will fail the build if unit test fails and Gcov results will get pushed to SonarCloud.</p>
<h1>Usage</h1>
<p>Compile and flash the project to your board using SES. Instructions on how to use a bootloader will be added later on. The project is not yet in a useful state for any practical purpose other than learning.</p>
<p>Note: You should erase your board entirely in case there is a bootloader from a previous firmware.</p>
<h1>How to contribute</h1>
<p>Please let us know your thoughts on the direction and structure of the project. Does the project help you to understand how to build code on RuuviTag? Is the structure of the project sensible to you?</p>
<p>If you want to assist in the project maintenance by fixing some issues <em>doxygen.error</em> is a good place to look for code which needs better commenting. Project badges at the top of the readme point to issues which range from trivial clarifications to complex refactoring.</p>
<p>If you want to add new features, please discuss the feature first, and then create ceedling unit tests for the functionality. Once the functionality is agreed and testable in can be integrated into project.</p>
<h1>Licensing</h1>
<p>Ruuvi code is BSD-3 licensed. Submodules and external dependencies have their own licenses, which are BSD-compatible.</p>
<h1>Documentation</h1>
<p>Document is generated with Doxygen. Run <code>make doxygen</code> to generate the docs locally, or browse to <a href="ruuvi.github.io/ruuvi.firmware.c">Travis built docs</a></p>
<h1>Changelog</h1>
<h2>3.28.12</h2>
<ul>
<li>Automatically release a tag</li>
</ul>
<h2>3.28.11</h2>
<ul>
<li>Fix battery voltage monitoring</li>
<li>Fix advertisements not restarting after GATT connection</li>
</ul>
<h2>3.28.10</h2>
<ul>
<li>Fix issue in drivers preventing build</li>
</ul>
<h2>3.28.9</h2>
<ul>
<li>Fix 811 builds</li>
<li>Fix movement interrupts / counter</li>
</ul>
<h2>3.28.8</h2>
<ul>
<li>Refactor communication</li>
<li>Do not send heartbeats while processing log.</li>
</ul>
<h2>3.28.7</h2>
<ul>
<li>Fix long-life sensors not sampling.</li>
</ul>
<h2>3.28.6</h2>
<ul>
<li>Add Travis CI and SonarCloud support</li>
</ul>
<h2>3.28.5</h2>
<ul>
<li>Convert project to use Ceedling for unit tests.</li>
</ul>
<h2>3.28.1 ... 3.28.4</h2>
<ul>
<li>Bugfixes</li>
<li>Add longlife-logging</li>
</ul>
<h2>3.28.0</h2>
<ul>
<li>Fix storing and loading sensor configurations</li>
<li>Store fatal error sources to flash before reboot.</li>
</ul>
<h2>3.27.2</h2>
<ul>
<li>Use busyloop in log flush to avoid getting stuck if logs are flushed in interrupt context</li>
<li>Initialize variables in environmental logging to zero. Explicit U64-&gt;U32 timestamp typecast.</li>
</ul>
<h2>3.27.1</h2>
<ul>
<li>Fix errors in data format 5 encoding</li>
<li>Known issue: timestamps are occasionally wrong in log data</li>
</ul>
<h2>3.27.0</h2>
<ul>
<li>Rework task structure</li>
<li>Add "hearbeat" transmissions to GATT</li>
</ul>
<h2>3.26.5</h2>
<ul>
<li>Add SD+BL+APP DFU builds</li>
</ul>
<h2>3.26.4</h2>
<ul>
<li>Do not block if RTT logs are not read in debug mode</li>
</ul>
<h2>3.26.3</h2>
<ul>
<li>Fix build script in case of out-of-master submodule commits</li>
</ul>
<h2>3.26.2</h2>
<ul>
<li>Fix Keijo build</li>
</ul>
<h2>3.26.1</h2>
<ul>
<li>Improve logging sent elements.</li>
<li>Send 0xFFFFFFFF payload at the end of log data</li>
<li>Block until RTT logs are sent in debug mode</li>
</ul>
<h2>3.26.0</h2>
<ul>
<li>Add Humidity, pressure logging PoC</li>
</ul>
<h2>3.25.1</h2>
<ul>
<li>Add Temperature logging PoC</li>
</ul>
<h2>3.24.2</h2>
<ul>
<li>Switch Keijo to S140 for Coded PHY</li>
<li>Discard Keijo GATT, bootlaoder</li>
</ul>
<h2>3.24.1</h2>
<ul>
<li>Fit Keijo application in nRF52811</li>
</ul>
<h2>3.24.0</h2>
<ul>
<li>Initial support for "Keijo"-project</li>
<li>Port to SDK15.3</li>
</ul>
<h2>3.23.0</h2>
<ul>
<li>Initial support for "Kaarle"-project</li>
</ul>
<h2>3.22.1</h2>
<ul>
<li>Use acceleration interrupts for movement counter</li>
</ul>
<h2>3.22.0</h2>
<ul>
<li>Add low-power delay to drivers</li>
<li>Try to initialize a separate pressure sensor if using SHTC as environmental sensor</li>
<li>Add pressure sensor tasks</li>
</ul>
<h2>3.19.0 ... # 3.21.0</h2>
<ul>
<li>Various reworks and refactoring.</li>
</ul>
<h2>3.18.0</h2>
<ul>
<li>Use refactored drivers.</li>
</ul>
<h2>3.17.0</h2>
<ul>
<li>Add NFC writes to tag</li>
<li>Disable GATT</li>
<li>Use activity interrupts, advertise data format 5</li>
<li>Trigger watchdog if data is not sent via NFC, GATT or advertisement for 120 seconds.</li>
<li>27 uA current consumption at 3V</li>
</ul>
<h2>3.16.0</h2>
<ul>
<li>Add GATT profile</li>
<li>Stream accelerometer data over GATT / NUS</li>
<li>Tigger watchdog if data is not sent over NUS for 120 seconds</li>
<li>Disable data advertising</li>
<li>Disable activity interrupts from LIS2DH12</li>
</ul>
<h2>3.15.0</h2>
<ul>
<li>Add watchdog, reset if button is not pressed.</li>
</ul>
<h2>3.14.0</h2>
<ul>
<li>Add interrupts to accelerometer</li>
<li>Add data format 5 support</li>
</ul>
<h2>3.13.0</h2>
<ul>
<li>Synchronize battery measurements to radio</li>
</ul>
<h2>3.12.0</h2>
<ul>
<li>Bootloader in a <a href="https://github.com/ruuvi/ruuvi.nrf5_sdk15_bootloader.c">separate repository</a></li>
</ul>
<h2>3.11.0</h2>
<ul>
<li>Add scheduler and timer, update transmitted data once per second.</li>
<li>Environmental sensor is now in continuous mode and has IIR filtering at 16x (was oversampling)</li>
<li>ADC is now read once per minute</li>
</ul>
<h2>3.10.0</h2>
<p>Adds NFC tag functionality - read only</p>
<h2>3.9.0</h2>
<p>Adds BLE broadcasts</p>
<h2>3.8.0</h2>
<p>Adds RTC</p>
<h2>3.7.0</h2>
<p>Adds battery measurement</p>
<h2>3.6.0</h2>
<p>Adds Accelerometer polling</p>
<h2>3.5.0</h2>
<p>Adds environmental sensing</p>
<h2>3.4.0</h2>
<p>Adds button control to blink leds</p>
<h2>3.3.0</h2>
<p>Adds Led blinking example</p>
<h2>3.2.0</h2>
<p>Adds logging and error code handling</p>
<h2>3.1.1</h2>
<p>Put external sensors to sleep and then put MCU to sleep. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
